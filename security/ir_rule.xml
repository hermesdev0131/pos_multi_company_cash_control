<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data noupdate="0">
        <!--
            Record Rule: Allow POS users to read and write orders from companies they have access to

            This rule is necessary because the multi-company cash control module
            creates orders in different companies (fiscal vs non-fiscal) based on routing rules.

            Without this rule, users get "Access Error" when the POS tries to read or update
            an order that was created in a company different from their current session company.

            CRITICAL: POS operations require write access to update order status, payments, etc.
            This rule allows POS users to write orders in any company they have access to.

            Security Note:
            - Allows READ and WRITE access (no create/delete)
            - Only applies to POS users (point_of_sale.group_pos_user)
            - Respects user's company access rights (company_ids)
            - Users must be granted access to fiscal and non-fiscal companies in their user settings
        -->
        <record id="pos_order_multi_company_read_rule" model="ir.rule">
            <field name="name">POS Order: Multi-Company Cash Control Read/Write Access</field>
            <field name="model_id" ref="point_of_sale.model_pos_order"/>
            <field name="domain_force">[('company_id', 'in', company_ids)]</field>
            <field name="groups" eval="[(4, ref('point_of_sale.group_pos_user'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="False"/>
            <field name="perm_unlink" eval="False"/>
        </record>

        <!--
            Record Rule: Allow POS users to read and write payments from companies they have access to

            When orders are created in different companies, their related payment records
            also need to be readable and writable for the POS to function correctly.

            CRITICAL: POS operations require write access to update payment status, amounts, etc.
            This rule allows POS users to write payments in any company they have access to.
        -->
        <record id="pos_payment_multi_company_read_rule" model="ir.rule">
            <field name="name">POS Payment: Multi-Company Cash Control Read/Write Access</field>
            <field name="model_id" ref="point_of_sale.model_pos_payment"/>
            <field name="domain_force">[('company_id', 'in', company_ids)]</field>
            <field name="groups" eval="[(4, ref('point_of_sale.group_pos_user'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="False"/>
            <field name="perm_unlink" eval="False"/>
        </record>
    </data>
</odoo>
